<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />		
		<title class="title-name"></title>
		<link rel="stylesheet" type="text/css" href="../css/reset.css"/>
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css"/>
		<link rel="stylesheet" type="text/css" href="../css/recomment.css"/>
		<link rel="stylesheet" type="text/css" href="../css/zy.media.min.css"/>
		<script type="text/javascript" src="../js/jquery-2.0.3.js"></script>
		<script type="text/javascript" src="../js/remn.js"></script>
		<script type="text/javascript" src="../js/ShareSDK.js"></script>
		<script type="text/javascript" src="../layer_mobile/layer.js"> </script>
		<script type="text/javascript" src="../js/zy.media.min.js"></script>
		<script type="text/javascript">
			$(window).load(function() {
				$('#box1').delay(350).fadeIn()
			})
        function shareContentClickHandler(summary,imgurl,title,url)
        {
            var params = {
                "text" : summary,
                "imageUrl" : imgurl,
                "title" : title,
                "url" : url,
                "description" : "测试的描述",
                "site" : "ShareSDK",
                "siteUrl" : "http://sharesdk.cn",
                "type" : $sharesdk.ContentType.WebPage
            };
            $sharesdk.shareContent($sharesdk.PlatformID.WeChat, params, function (reqId, platform, state, shareInfo, error) {
                   shareVideo();
            });
        }
        function shareContentClickHandler1(summary,imgurl,title,url)
        {
            var params = {
                "text" : summary,
                "imageUrl" : imgurl,
                "title" : title,
                "url" : url,
                "description" : "测试的描述",
                "site" : "ShareSDK",
                "siteUrl" : "http://sharesdk.cn",
                "type" : $sharesdk.ContentType.WebPage
            };
            $sharesdk.shareContent($sharesdk.PlatformID.WeChatMoments, params, function (reqId, platform, state, shareInfo, error) {
                    shareVideo();
            });
        }
        function shareContentClickHandler2(summary,imgurl,title,url)
        {
            var params = {
                "text" : summary,
                "imageUrl" : imgurl,
                "title" : title,
                "titleUrl" : url,
                "description" : "测试的描述",
                "site" : "ShareSDK",
                "siteUrl" : "http://sharesdk.cn",
                "type" : $sharesdk.ContentType.WebPage
            };
            $sharesdk.shareContent($sharesdk.PlatformID.QQ, params, function (reqId, platform, state, shareInfo, error) {
                 shareVideo();
            });
        }
        function shareContentClickHandler3(text,urlimg)
        {
        	//console.log(text)
            var params = {
                "text" : text,
                "imageUrl" : urlimg,
                "title" : "测试的标题",
                "url" : "http://sharesdk.cn",
                "description" : "测试的描述",
                "site" : "ShareSDK",
                "siteUrl" : "http://sharesdk.cn",
                "type" : $sharesdk.ContentType.Text
            };
            $sharesdk.shareContent($sharesdk.PlatformID.SinaWeibo, params, function (reqId, platform, state, shareInfo, error) {
                       shareVideo();
                      layer.msg('分享成功');
            });
        }
		</script>
	</head>
	<body>
	<div id="box1">
		<div id="box">
			<section class="recomment-cont">
				<div class="video-cont">
				</div>
				<!--视频推荐-->
					<div class="video-recommended">
						<div class="video-recommended-title clear">
							<p></p>
						    <p>精彩视频推荐</p>
						</div>
					</div>
				<div class="share-cont-tv">分享精彩视屏</div>
				<div class="share-cont-type msosh">
					<ul>
						<li class="sharewxf">
							<i class="iconfont">&#xe60d;</i>
						</li>
						<li class="sharewx">
							<i class="iconfont">&#xe647;</i>
						</li>
						<li class="shareqq">
							<i class="iconfont">&#xe61f;</i>
						</li>
						<li class="sharewb">
							<i class="iconfont">&#xe619;</i>
						</li>
					</ul>
				</div>
				<div class="down-app clear">
					<div class="down-app-img"></div>
				    <p class="down-app-p">安装 hi+5,看更多精彩内容</p>
				    <div class="download-app download-index">立即下载</div>
				</div>
                <div class="video-code">
						<img class="video-code-img" src="../img/erweima.gif"/>
						<p class="video-code-p">长按二维码关注 hi+5 微信公众号</p>
						<div class="video-code-middle">
							<div></div>
						    <h2>或</h2>
						    <div></div>
						</div>
						<div class="video-code-phone clear">
							<img class="download-index" src="../img/appple.jpg"/>
							<img class="download-index" src="../img/android.png"/>
						</div>
						<p class="video-code-p2" >各大应用商店搜索 “hi+5”微信公众号</p>
					</div>
					
                <div class="share-mask">
						<img src="../img/share_arrow.png"/>
				</div>
			</section>
			<div class="video-code-foot download-index">
				<div class="today-foot-img"></div>
				<p>高清视频分享平台</p>
	            <p class="icon">立即下载</p>
			</div>
			
		</div>
		<div class="refresh">
			<img src="../img/resh.png" alt="" />
		</div>
	</div>
	</body>
	<script type="text/javascript">
	var servername ='http://www.hiplus5.com';
	//var servername ='http://192.168.199.114:8080';
	function GetQueryString(name)
		{
			var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
		    var r = window.location.search.substr(1).match(reg);
		    if(r!=null)
		    	return unescape(r[2]); 
		    return "";
		}
		var video_id = GetQueryString("video_id");
		var userId = GetQueryString("user_id");
	    /*android分享*/
	    var subject_title;
		var subject_img_url;
		var subject_content;
		var subject_url;
		//video_id="48f1d8a02bf54324b88c7b0e632ec2b2"
        /*android分享传参*/
        function getInfo(){
		    HostApp.shareInfo(subject_title,subject_img_url,subject_content,subject_url);
		  }
	/*视频推送*/
	$.ajax({
            type: 'POST',
            url: servername+'/HJF/user/get_video_info.do',
            dataType: 'JSON',
            data:{video_id:video_id},
            success: function(data){
            	if(data.result=="1")
            	{
            		subject_title=data.data.video_title;
			        subject_img_url=data.data.video_img_url;
					subject_content=data.data.video_summary;
					subject_url=data.data.video_share_url;
		            /*分享给朋友*/
		            $('.sharewxf').on('click',function(){
		            	
		            	//console.log(data.data.video_title)
		            	shareContentClickHandler(data.data.video_summary,data.data.video_img_url,data.data.video_title,data.data.video_share_url);
		            	
		            })
		            /*分享到朋友圈*/
		            $('.sharewx').on('click',function(){
		            	 shareContentClickHandler1(data.data.video_summary,data.data.video_img_url,data.data.video_title,data.data.video_share_url);
		            	 
		            })
		            /*分享到qq*/
		            $('.shareqq').on('click',function(){
		            	shareContentClickHandler2(data.data.video_summary,data.data.video_img_url,data.data.video_title,data.data.video_share_url);
		            	
		            })
		            /*分享到微博*/
		           $('.sharewb').on('click',function(){
		         	var title=data.data.video_title+data.data.video_share_url+"快@HiPlus5"+"http://a.app.qq.com/o/simple.jsp?pkgname=com.svd.hi5";
		         	//console.log(title)
		         	shareContentClickHandler3(title,data.data.video_img_url);
		         	
		            })
	            	$('.title-name').html(data.data.video_title)
	            	var oImg=$('<img class="videoimg" src="'+data.data.video_img_url+'">')
	            	var oDiv=$('<div class="video-cont" style="position: relative;height: 4rem;">'+
							'<div class="zy_media" style="height: 4rem;  background: #262628;">'+
						    '<video class="video" style="background:url() no-repeat;background-size:cover;" controls="controllers" width="100%" height: 100%; poster="">'+
						    '<source src="'+data.data.video_url+'" type="video/mp4">您的浏览器不支持HTML5视频'+
						    '</video>'+
							'</div>'+
			                '<div class="theme-video-bg" style="background: url('+data.data.video_img_url+') no-repeat;background-size:cover;position:absolute;top:0;height:4rem;width:7rem;">'+
			                '</div><img class="play-start" style="position: absolute;left: 50%;top: 50%;height: 1rem;width: 1rem;margin-left: -0.5rem;margin-top: -0.5rem;" src="../img/start.png"/>'+
			                '</div>')
		            	$('.video-cont').append(oImg)
		            	$('.video-cont').append(oDiv)
	            	if(data.data.channel_name==''){
	            		var oDiv2=$('<div class="video-cont-head">'+
							      '<p>'+data.data.video_title+'</p>'+
							      '<p>'+data.data.video_label_name+' / '+data.data.video_time+'</p>'+
						          '</div>')
	            	        $('.video-cont').append(oDiv2)
	            	}else{
	            		var oDiv2=$('<div class="video-cont-head">'+
								  '<p>'+data.data.video_title+'</p>'+
								  '<p>'+data.data.channel_name+' | '+data.data.video_label_name+' / '+data.data.video_time+'</p>'+
								  '</div>')
	            	        $('.video-cont').append(oDiv2)
	            	}
	            	var oP=$('<p class="video-cont-foot">'+data.data.video_summary+'</p>')
	            	     $('.video-cont').append(oP)
		            	/*视频播放*/
				   	    zymedia('video');
					    $('.play-start').on('click',function(){
					   	$(this).hide();
					   	$(this).siblings('.theme-video-bg').hide()
					   	$(this).siblings('.zy_media').children('.zy_wrap').children('.video')[0].play();
					    })	
            	}
            	else
            	{
            		layer.open({
				    content: '系统繁忙'
				    ,btn: '我知道了'
				    });
            	}
            	
            },
            error: function(xhr, type){
                layer.open({
			    content: '系统繁忙'
			    ,btn: '我知道了'
			    });
            }
        });
	   
	 $('.download-index').on('click',function(){
	 	transferTo()
	 })
	  /*精彩视频推荐*/
		$.ajax({
            type: 'POST',
            url: servername+'/HJF/user/get_home.do',
            dataType: 'JSON',
            success: function(data){
            	console.log(data)
            	if(data.result=="1")
            	{
            		$.each(data.daily_list, function(index) {
	            		var oDiv=$('<div class="video-recommended-first clear download-index">'+
								'<img class="video-recommended-img" src="'+data.daily_list[index].video_img_url+'"/>'+
								'<div class="video-recommended-detail">'+
								'<p>'+data.daily_list[index].video_title+'</p>'+
								'<p>'+data.daily_list[index].channel_name+' | '+data.daily_list[index].video_label_name+' / '+data.daily_list[index].video_time+'</p>'+
								'</div>'+
							    '</div>')
	            		   $('.video-recommended').append(oDiv)
	            	})
	            	$('.download-index').on('click',function(){
							transferTo()
						})
            	}
            	else{
            		layer.open({
				    content: '系统繁忙'
				    ,btn: '我知道了'
				    });
            	}
            	HostApp.dismissLoading()
            	$('.refresh').hide()
            	$('#box').show()
            	$('.recomment-cont').show()
            },
            error: function(xhr, type){
                layer.open({
				    content: '系统繁忙'
				    ,btn: '我知道了'
				    });
            }
        });
        
        function shareVideo()
	    {
	    	$.ajax({
	            type: 'POST',
	            url: servername+'/HJF/user/share_video.do',
	            dataType: 'JSON',
	            data:{user_id:userId,video_id:video_id},
	            success: function(data){
	            	//console.log(data)
	            },
	            error: function(xhr, type){
	               /* layer.open({
				    content: '系统繁忙'
				    ,btn: '我知道了'
				    });*/
	            }
	        });
	    }
	 /*判断是微信端还是android或ios端*/
		transfer()
		function transfer(){
             var ub = navigator.userAgent.toLowerCase();//获取判断用的对象
              if (ub.match(/MicroMessenger/i) == "micromessenger") {
              	  $('.refresh').show();
              	  $('.share-cont-type').hide();
              	  $('.share-cont-tv').hide();
              	  $('.down-app').show();
              	  $('.video-code').show();
              	  $('.video-code-foot').show();
		        }else if (ub.match(/WeiBo/i) == "weibo") {
		          $('.refresh').show();
              	  $('.share-cont-type').hide();
              	  $('.share-cont-tv').hide();
              	  $('.down-app').show();
              	  $('.video-code').show();
              	  $('.video-code-foot').show();
             }else if(ub.match(/QQ/i) == "qq"){
             	  $('.refresh').show();
              	  $('.share-cont-type').hide();
              	  $('.share-cont-tv').hide();
              	  $('.down-app').show();
              	  $('.video-code').show();
              	  $('.video-code-foot').show();
             }else{
             	$('.share-cont-tv').show()
              	$('.share-cont-type').show()
           }
		}
	 /*判断是微信端还是android或ios端*/
		function isWeiXin(){
		    var ua = window.navigator.userAgent.toLowerCase();
		    if(ua.match(/MicroMessenger/i) == 'micromessenger'){
		        return true;
		    }else{
		        return false;
		    }
		}
		 
		function transferTo(){
		    var ub = navigator.userAgent.toLowerCase();//获取判断用的对象
              if (ub.match(/MicroMessenger/i) == "micromessenger") {
              	 window.location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.svd.hi5";
		        }else if (ub.match(/WeiBo/i) == "weibo") {
		        	window.location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.svd.hi5";
             }else if(ub.match(/QQ/i) == "qq"){
             	window.location.href="http://a.app.qq.com/o/simple.jsp?pkgname=com.svd.hi5";
             }else{
              	
           }
		}
		
		function goPAGE() {
			    if ((navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))) {
			       $('.dec_play').hide()
			}else {
			         $('.dec_play').show()
			}
		}
		goPAGE();//调用判断函数
		function dismissLoading(){}
	</script>
</html>
